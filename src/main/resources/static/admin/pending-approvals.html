<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Pending Approvals</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 font-sans">

<!-- Navbar -->
<nav class="fixed top-0 left-0 right-0 bg-gradient-to-r from-red-600 to-pink-500 text-white shadow-md px-6 py-4 flex justify-between items-center z-50">
    <a href="#" class="flex items-center space-x-4 select-none">
        <!-- Logo Circle with Image -->
        <div class="w-10 h-10 md:w-12 md:h-12 rounded-full bg-white flex justify-center items-center overflow-hidden">
            <img src="/images/logo.png" alt="Blood Donor Finder Logo" class="w-8 h-8 md:w-10 md:h-10 object-contain" />
        </div>
        <h1 class="text-2xl font-bold tracking-wide">Blood Donor Finder - Pending Approvals</h1>
    </a>
    <a href="/admin/dashboard.html" class="bg-white text-red-600 px-4 py-2 rounded-lg hover:bg-red-100 font-medium transition">Back</a>
</nav>

<div class="max-w-7xl mx-auto mt-28 px-4">
    <h2 class="text-3xl font-semibold text-center text-red-600 mb-8">Pending Donor Approvals</h2>

    <div class="grid gap-6" id="pendingList">
        <!-- Donors will be inserted here -->
    </div>
</div>

<script>
    async function loadPendingDonors() {
        const res = await fetch("http://localhost:8082/api/donors/pending");
        const donors = await res.json();
        const list = document.getElementById("pendingList");
        list.innerHTML = '';

        if (donors.length === 0) {
            list.innerHTML = `<div class="text-center text-gray-500">No pending donors.</div>`;
            return;
        }

        donors.forEach(donor => {
            const div = document.createElement("div");
            div.className = "bg-white rounded-2xl shadow-lg p-6 md:flex gap-6 hover:shadow-2xl transition";

            div.innerHTML = `
                <div class="md:w-1/3 flex justify-center mb-4 md:mb-0">
                    <img src="/uploads/${donor.citizenshipPhotoPath}" alt="Citizenship" class="rounded-xl shadow h-48 object-cover w-full">
                </div>
                <div class="flex-1">
                    <p><strong>Name:</strong> ${donor.name}</p>
                    <p><strong>Age:</strong> ${donor.age}</p>
                    <p><strong>Gender:</strong> ${donor.gender}</p>
                    <p><strong>Blood Group:</strong> ${donor.bloodGroup}</p>
                    <p><strong>Location:</strong> ${donor.location}</p>
                    <p><strong>Contact:</strong> ${donor.contact}</p>
                    <div class="mt-4 flex gap-3">
                        <button onclick="approve(${donor.id})" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition">Approve</button>
                        <button onclick="reject(${donor.id})" class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition">Reject</button>
                    </div>
                </div>
            `;
            list.appendChild(div);
        });
    }

    async function approve(id) {
        const res = await fetch(`http://localhost:8082/api/donors/approve/${id}`, { method: "PUT" });
        if (res.ok) {
            alert("Approved successfully");
            loadPendingDonors();
        }
    }

    async function reject(id) {
        if (!confirm("Are you sure to reject/delete this donor?")) return;
        const res = await fetch(`http://localhost:8082/api/donors/${id}`, { method: "DELETE" });
        if (res.ok) {
            alert("Rejected and deleted");
            loadPendingDonors();
        }
    }

    window.onload = loadPendingDonors;
</script>

</body>
</html>
