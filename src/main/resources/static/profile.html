<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>My Profile</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 font-sans">

<!-- Navbar -->
<nav class="fixed top-0 left-0 right-0 bg-gradient-to-r from-red-600 to-pink-500 text-white shadow-md px-6 py-4 flex justify-between items-center z-50">
    <h1 class="text-2xl font-bold">My Profile</h1>
    <a href="/home.html" class="bg-white text-red-600 px-4 py-2 rounded-lg hover:bg-red-100 font-medium transition">
        Home
    </a>
</nav>

<!-- Profile Card -->
<div class="max-w-4xl mx-auto mt-32 bg-white rounded-2xl shadow-xl p-8">
    <!-- Profile Header -->
    <div class="flex flex-col md:flex-row items-center md:items-start md:space-x-8 mb-8">
        <div class="w-32 h-32 rounded-full bg-red-100 flex items-center justify-center text-red-600 text-4xl font-bold shadow-md">
            ðŸ‘¤
        </div>
        <div class="mt-4 md:mt-0 text-center md:text-left">
            <h2 class="text-2xl font-bold" id="displayName">Your Name</h2>
            <p class="text-gray-500" id="displayEmail">your@email.com</p>
            <span class="inline-block mt-2 px-3 py-1 text-sm rounded-full bg-green-100 text-green-700" id="displayAvailability">
        Available
      </span>
        </div>
    </div>

    <!-- Profile Details Form -->
    <h3 class="text-lg font-semibold mb-4 border-b pb-2">Edit Profile</h3>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Name</label>
            <input type="text" id="name" class="w-full p-3 border rounded-lg bg-gray-50 focus:ring-2 focus:ring-red-400" readonly>
        </div>

        <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
            <input type="text" id="email" class="w-full p-3 border rounded-lg bg-gray-50 focus:ring-2 focus:ring-red-400" readonly>
        </div>

        <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Blood Group</label>
            <input type="text" id="bloodGroup" class="w-full p-3 border rounded-lg bg-gray-50 focus:ring-2 focus:ring-red-400" readonly>
        </div>

        <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Location</label>
            <input type="text" id="location" class="w-full p-3 border rounded-lg bg-gray-50 focus:ring-2 focus:ring-red-400" readonly>
        </div>

        <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Contact</label>
            <input type="text" id="contact" class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-red-400">
        </div>

        <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Availability</label>
            <select id="availability" class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-red-400">
                <option value="Available">Available</option>
                <option value="Not Available">Not Available</option>
            </select>
        </div>
    </div>

    <!-- Update Button -->
    <div class="mt-8 text-center">
        <button onclick="updateProfile()"
                class="bg-gradient-to-r from-red-600 to-pink-500 text-white px-6 py-3 rounded-xl font-semibold hover:scale-105 transform transition shadow-lg">
            Update Profile
        </button>
    </div>
</div>

<script>
    async function loadProfile() {
      const response = await fetch('http://localhost:8082/api/donors/profile', {
        method: 'GET',
        credentials: 'include'
      });
      if (!response.ok) return alert("Failed to load profile");

      const donor = await response.json();
      document.getElementById('name').value = donor.name;
      document.getElementById('email').value = donor.email;
      document.getElementById('bloodGroup').value = donor.bloodGroup;
      document.getElementById('location').value = donor.location;
      document.getElementById('contact').value = donor.contact;
      document.getElementById('availability').value = donor.availability || 'Available';

      // Display info in header
      document.getElementById('displayName').innerText = donor.name;
      document.getElementById('displayEmail').innerText = donor.email;
      document.getElementById('displayAvailability').innerText = donor.availability;
      document.getElementById('displayAvailability').className =
        donor.availability === "Available"
          ? "inline-block mt-2 px-3 py-1 text-sm rounded-full bg-green-100 text-green-700"
          : "inline-block mt-2 px-3 py-1 text-sm rounded-full bg-gray-200 text-gray-600";
    }

    async function updateProfile() {
      const payload = {
        contact: document.getElementById('contact').value,
        availability: document.getElementById('availability').value
      };

      const response = await fetch('http://localhost:8082/api/donors/profile', {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        credentials: 'include',
        body: JSON.stringify(payload)
      });

      if (response.ok) {
        alert("Profile updated successfully!");
        loadProfile();
      } else {
        alert("Failed to update profile");
      }
    }

    window.onload = loadProfile;
</script>

</body>
</html>
